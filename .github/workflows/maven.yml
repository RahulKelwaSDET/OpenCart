name: CI Pipeline

# Trigger the workflow on push and pull requests to main branch
on:
  push:
    branches:
      - master
  pull_request:
    branches:
      - master

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    steps:
      # Checkout the repository code
      - name: Checkout code
        uses: actions/checkout@v3

      # Set up JDK 1.8
      - name: Setup Java
        uses: actions/setup-java@v3
        with:
          java-version: '8'  # Matches Java 1.8 requirement
          distribution: 'temurin'  # Eclipse Temurin distribution for JDK

      # Cache Maven dependencies
      - name: Cache Maven dependencies
        uses: actions/cache@v3
        with:
          path: ~/.m2/repository
          key: ${{ runner.os }}-maven-${{ hashFiles('**/pom.xml') }}
          restore-keys: ${{ runner.os }}-maven-

      # Run Maven build with specified command
      - name: Build with Maven
        run: mvn clean install -Denv="qa"

      # Optional: Display build output (e.g., for debugging)
      - name: List target directory
        run: ls -la target/
        if: success() || failure()  # Runs even if build fails for debugging

    # Environment variables (optional, adjust if needed)
    env:
      MAVEN_OPTS: '-Xmx1024m'  # Optional: Adjust memory settings if needed
